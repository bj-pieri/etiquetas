<!DOCTYPE html>
<html lang="pt-BR" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Etiquetas Profissional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Inter para UI, JetBrains Mono para dados técnicos -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Mantemos class, mas gerenciaremos manualmente as classes .dark e .gruvbox
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        label: ['-apple-system', 'BlinkMacSystemFont', '"San Francisco"', '"Helvetica Neue"', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        // Cores Semânticas baseadas em CSS Variables
                        skin: {
                            base: 'var(--color-bg-base)',       // Fundo da área de preview (canvas)
                            sidebar: 'var(--color-bg-sidebar)', // Fundo da barra lateral
                            input: 'var(--color-bg-input)',     // Fundo dos inputs
                            border: 'var(--color-border)',      // Bordas gerais
                            text: 'var(--color-text-main)',     // Texto principal
                            muted: 'var(--color-text-muted)',   // Texto secundário
                            accent: 'var(--color-accent)',      // Cor de destaque (Brand)
                            'accent-hover': 'var(--color-accent-hover)',
                            dot: 'var(--color-dot)',            // Cor dos pontos do grid
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 20px -5px var(--color-accent)', // Glow adaptativo
                        'card': '0 2px 8px -2px rgba(0,0,0,0.05), 0 0 1px rgba(0,0,0,0.1)',
                    },
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* --- DEFINIÇÃO DE TEMAS (CSS VARIABLES) --- */
        :root {
            /* Light Theme (Padrão) - Zinc & Indigo */
            --color-bg-base: #f8fafc;       /* Zinc 50 */
            --color-bg-sidebar: #ffffff;    /* White */
            --color-bg-input: #f4f4f5;      /* Zinc 100 */
            --color-border: #e4e4e7;        /* Zinc 200 */
            --color-text-main: #18181b;     /* Zinc 900 */
            --color-text-muted: #71717a;    /* Zinc 500 */
            --color-accent: #6366f1;        /* Indigo 500 */
            --color-accent-hover: #4f46e5;  /* Indigo 600 */
            --color-dot: #cbd5e1;           /* Slate 300 */
        }

        .dark {
            /* Dark Theme - Zinc & Indigo */
            --color-bg-base: #18181b;       /* Zinc 900 */
            --color-bg-sidebar: #09090b;    /* Zinc 950 */
            --color-bg-input: #27272a;      /* Zinc 800 */
            --color-border: #27272a;        /* Zinc 800 */
            --color-text-main: #f4f4f5;     /* Zinc 100 */
            --color-text-muted: #a1a1aa;    /* Zinc 400 */
            --color-accent: #6366f1;        /* Indigo 500 */
            --color-accent-hover: #818cf8;  /* Indigo 400 */
            --color-dot: #3f3f46;           /* Zinc 700 */
        }

        .gruvbox {
            /* Gruvbox Theme - Retro Warm Dark */
            --color-bg-base: #1d2021;       /* Hard Dark */
            --color-bg-sidebar: #282828;    /* Dark 1 */
            --color-bg-input: #3c3836;      /* Dark 2 */
            --color-border: #504945;        /* Dark 3 */
            --color-text-main: #ebdbb2;     /* Light 1 */
            --color-text-muted: #a89984;    /* Gray */
            --color-accent: #d65d0e;        /* Orange */
            --color-accent-hover: #fe8019;  /* Bright Orange */
            --color-dot: #504945;           /* Dark 3 for dots */
        }

        /* --- Reset e Base --- */
        * { box-sizing: border-box; }
        body { overflow: hidden; } 

        /* --- Padrão de Fundo (Grid) usando Variáveis --- */
        .bg-grid-pattern {
            background-color: var(--color-bg-base);
            background-image: radial-gradient(var(--color-dot) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--color-dot); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-text-muted); }

        /* --- Estilos da Etiqueta (Visualização) --- */
        .etiqueta {
            position: relative;
            background-color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", Helvetica, "Segoe UI", Arial, sans-serif;
            letter-spacing: -0.01em;
            border-radius: 8px;
        }

        .etiqueta:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1), 0 8px 8px -6px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        
        .etiqueta::before { 
            content: ''; position: absolute; inset: 5px;
            background-image: url('https://belportas.com.br/wp-content/uploads/2022/05/perfil-linktree.png'); 
            background-position: center; background-repeat: no-repeat; background-size: contain; 
            opacity: 0.08; z-index: 0; pointer-events: none;
            -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;
        }
        @media print { .etiqueta::before { opacity: 0.15 !important; } }

        .data-stamp {
            position: absolute; bottom: 8px; left: 12px;
            font-size: 12px; font-weight: 700; color: #000;
            z-index: 10; background: transparent; border: none; width: 100px;
            outline: none; cursor: text;
            font-family: inherit;
        }
        .data-stamp:hover { background-color: rgba(99, 102, 241, 0.1); border-radius: 2px; }

        /* --- Layout Tela --- */
        body:not(.thermal-layout) .page-container-screen {
            display: grid; grid-template-columns: repeat(2, 8.5cm); gap: 1rem; padding: 1rem; justify-content: center;
        }
        body:not(.thermal-layout) .etiqueta { width: 8.5cm; height: 4.5cm; }

        body.thermal-layout .page-container-screen {
            display: flex; flex-direction: column; align-items: center; gap: 1rem; padding: 1rem;
        }
        /* Tamanho de tela 9x5cm da etiqueta zebra */
        body.thermal-layout .etiqueta { width: 9cm; height: 5cm; }

        /* --- IMPRESSÃO --- */
        @media print {
            html, body { height: 100% !important; overflow: visible !important; background: white !important; width: 100% !important; margin: 0 !important; padding: 0 !important; }
            .no-print { display: none !important; }
            #app-wrapper, #main-content, #preview-area, #etiquetas-container { display: block !important; height: auto !important; overflow: visible !important; width: 100% !important; margin: 0 !important; padding: 0 !important; position: static !important; }
            #preview-area { background: none !important; }
            
            .etiqueta {
                box-shadow: none !important;
                border: 2px solid #000 !important;
                page-break-inside: avoid; break-inside: avoid;
                border-radius: 8px !important;
                transform: none !important;
            }
            .data-stamp { opacity: 1 !important; border: none !important; background: none !important; }
            .volume-box { background-color: #000 !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

            /* A4 Mode */
            body:not(.thermal-layout) .page-container-print {
                display: grid; grid-template-columns: repeat(2, 8.5cm); gap: 0.3cm; margin: 0 auto; page-break-after: always; break-after: page; width: fit-content; max-width: 100%; padding: 0.5cm;
            }
            body:not(.thermal-layout) .page-container-print:last-child { page-break-after: auto; break-after: auto; }
            body:not(.thermal-layout) .etiqueta { width: 8.5cm !important; height: 4.5cm !important; }

            /* Thermal (Zebra) Mode */
            body.thermal-layout .page-container-print { 
                display: flex; justify-content: center; align-items: center; 
                width: 100vw; height: 100vh; /* Se ajusta ao tamanho dinâmico do @page */
                margin: 0; padding: 0; 
                page-break-after: always; break-after: page; 
                overflow: hidden;
            }
            /* Previne a impressão de uma página extra no final */
            body.thermal-layout .page-container-print:last-child { page-break-after: auto; break-after: auto; }
            
            body.thermal-layout .etiqueta { 
                width: 100% !important; height: 100% !important; 
                margin: 0 !important; padding: 4mm !important; 
                border: none !important; border-radius: 0 !important;
            }
        }
    </style>
</head>
<!-- Aplicando variáveis de cor na raiz e transição lenta -->
<body class="bg-skin-base text-skin-text transition-colors duration-1000">

    <!-- Ícones SVG -->
    <svg class="hidden">
        <!-- Ícones funcionais -->
        <symbol id="icon-box" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></symbol>
        <symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
        <symbol id="icon-map" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></symbol>
        <symbol id="icon-hash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></symbol>
        <symbol id="icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></symbol>
        <symbol id="icon-printer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></symbol>
        <symbol id="icon-refresh" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></symbol>
        
        <!-- Ícones de Tema -->
        <symbol id="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></symbol>
        <symbol id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></symbol>
        <symbol id="icon-cube" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></symbol>
    </svg>

    <div id="app-wrapper" class="flex h-screen w-full overflow-hidden">
        
        <!-- SIDEBAR -->
        <aside class="w-full md:w-[380px] flex flex-col bg-skin-sidebar border-r border-skin-border z-30 shadow-2xl shadow-zinc-200/50 dark:shadow-none flex-shrink-0 transition-colors duration-1000 no-print">
            
            <!-- Branding -->
            <div class="p-6 border-b border-skin-border relative">
                <!-- Theme Toggle com 3 Estados -->
                <button id="theme-toggle" class="absolute right-4 top-4 p-2 rounded-full hover:bg-skin-input text-skin-muted transition-colors overflow-hidden group" title="Alternar Tema (Claro / Escuro / Gruvbox)">
                    <div class="relative w-5 h-5" id="theme-icon-container">
                        <!-- Ícones injetados via JS para controle preciso da rotação de 3 estados -->
                        <svg class="w-5 h-5 text-skin-accent"><use href="#icon-sun"></use></svg>
                    </div>
                </button>
                
                <div class="text-center pt-2">
                    <h1 class="text-xl font-bold text-skin-text tracking-tight font-sans leading-tight">
                        Gerador de Etiquetas<br>
                        <span class="text-skin-text font-extrabold">Bel Portas</span>
                    </h1>
                </div>
            </div>

            <!-- Form -->
            <div class="flex-1 overflow-y-auto px-6 py-6 space-y-6">
                <form id="form-etiqueta" class="space-y-5">
                    
                    <div class="space-y-1.5">
                        <label class="text-[11px] uppercase tracking-wider font-bold text-skin-muted pl-1">Destinatário</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-skin-muted group-focus-within:text-skin-accent transition-all duration-300 group-focus-within:scale-110 group-focus-within:-translate-y-0.5"><use href="#icon-user"></use></svg>
                            </div>
                            <input type="text" id="destinatario" required 
                                class="w-full bg-skin-input border border-skin-border text-skin-text text-sm rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-skin-accent/20 focus:border-skin-accent transition-all placeholder-gray-400 font-medium"
                                placeholder="Nome ou Empresa">
                        </div>
                    </div>

                    <div class="space-y-1.5">
                        <label class="text-[11px] uppercase tracking-wider font-bold text-skin-muted pl-1">Número do Pedido</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-skin-muted group-focus-within:text-skin-accent transition-all duration-300 group-focus-within:scale-110 group-focus-within:-translate-y-0.5"><use href="#icon-hash"></use></svg>
                            </div>
                            <input type="text" id="pedido" required 
                                class="w-full bg-skin-input border border-skin-border text-skin-text text-sm rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-skin-accent/20 focus:border-skin-accent transition-all placeholder-gray-400 font-mono"
                                placeholder="Ex: 63096">
                        </div>
                    </div>

                    <div class="space-y-1.5">
                        <label class="text-[11px] uppercase tracking-wider font-bold text-skin-muted pl-1">Cidade</label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-skin-muted group-focus-within:text-skin-accent transition-all duration-300 group-focus-within:scale-110 group-focus-within:-translate-y-0.5"><use href="#icon-map"></use></svg>
                            </div>
                            <input type="text" id="cidade" required 
                                class="w-full bg-skin-input border border-skin-border text-skin-text text-sm rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-skin-accent/20 focus:border-skin-accent transition-all placeholder-gray-400"
                                placeholder="São Paulo - SP">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1.5">
                            <label class="text-[11px] uppercase tracking-wider font-bold text-skin-muted pl-1">Volumes</label>
                            <div class="relative group">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-4 w-4 text-skin-muted group-focus-within:text-skin-accent transition-all duration-300 group-focus-within:scale-110 group-focus-within:-translate-y-0.5"><use href="#icon-box"></use></svg>
                                </div>
                                <input type="number" id="volumes" required min="1" value="1"
                                    class="w-full bg-skin-input border border-skin-border text-skin-text text-sm rounded-xl pl-9 pr-2 py-3 focus:outline-none focus:ring-2 focus:ring-skin-accent/20 focus:border-skin-accent transition-all font-mono">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-[11px] uppercase tracking-wider font-bold text-skin-muted pl-1">Data</label>
                            <div class="relative group">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-4 w-4 text-skin-muted group-focus-within:text-skin-accent transition-all duration-300 group-focus-within:scale-110 group-focus-within:-translate-y-0.5"><use href="#icon-calendar"></use></svg>
                                </div>
                                <input type="date" id="form-date" required 
                                    class="w-full bg-skin-input border border-skin-border text-skin-text text-[13px] rounded-xl pl-9 pr-1 py-3 focus:outline-none focus:ring-2 focus:ring-skin-accent/20 focus:border-skin-accent transition-all">
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 space-y-3">
                         <button type="button" id="btn-limpar"
                            class="w-full py-3.5 bg-skin-input hover:bg-skin-border text-skin-muted font-medium rounded-xl transition-colors border border-transparent hover:border-skin-border">
                            Limpar Campos e Reiniciar
                        </button>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="p-4 bg-skin-input border-t border-skin-border text-center">
                 <p class="text-[10px] text-skin-muted">Sistema otimizado para impressão de alto volume.</p>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main id="main-content" class="flex-1 flex flex-col h-full relative overflow-hidden bg-grid-pattern transition-colors duration-1000">
            
            <!-- Toolbar -->
            <div id="print-toolbar" class="absolute top-6 left-1/2 -translate-x-1/2 bg-skin-sidebar/80 backdrop-blur-md border border-skin-border shadow-xl rounded-full p-1.5 flex items-center gap-2 z-40 transition-all hover:scale-105 no-print">
                
                <div class="flex bg-skin-input rounded-full p-1">
                    <button id="btn-a4" class="px-5 py-2 text-[11px] font-bold rounded-full transition-all shadow-sm bg-skin-sidebar text-skin-text uppercase tracking-wide" data-mode="a4">Folha A4</button>
                    <button id="btn-thermal" class="px-5 py-2 text-[11px] font-bold rounded-full transition-all text-skin-muted hover:text-skin-text uppercase tracking-wide" data-mode="thermal">Etiqueta Zebra</button>
                </div>

                <div class="w-px h-6 bg-skin-border"></div>

                <button id="btn-print-toolbar" class="w-10 h-10 flex items-center justify-center text-skin-text hover:bg-skin-accent hover:text-white rounded-full transition-all duration-300 group" title="Imprimir (Ctrl+P)">
                    <svg class="w-5 h-5 group-hover:scale-110 transition-transform"><use href="#icon-printer"></use></svg>
                </button>
            </div>

            <!-- Preview -->
            <div id="preview-area" class="flex-1 overflow-y-auto overflow-x-hidden p-8 pt-24 pb-20 flex justify-center items-start">
                
                <div id="etiquetas-container" class="transition-opacity duration-500 ease-in-out">
                    <!-- Placeholder -->
                    <div id="placeholder" class="flex flex-col items-center justify-center h-[50vh] text-skin-muted select-none animate-in fade-in duration-700">
                        <div class="relative mb-6 group cursor-pointer">
                            <div class="absolute inset-0 bg-skin-accent/0 group-hover:bg-skin-accent/20 rounded-full blur-2xl transition-all duration-500"></div>
                            <svg class="w-40 h-40 text-skin-text relative z-10 transition-transform duration-500 group-hover:scale-105" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="100" cy="100" r="60" class="fill-skin-input transition-colors duration-500 group-hover:fill-skin-sidebar" />
                                <rect x="60" y="70" width="80" height="60" rx="4" class="stroke-skin-muted transition-colors duration-500 group-hover:stroke-skin-accent" stroke-width="2" stroke-dasharray="6 6" fill="none"/>
                                <g class="opacity-100 transition-opacity duration-500">
                                    <rect x="70" y="85" width="40" height="4" rx="2" class="fill-skin-muted transition-colors group-hover:fill-skin-text" />
                                    <rect x="70" y="95" width="60" height="4" rx="2" class="fill-skin-muted transition-colors group-hover:fill-skin-text" />
                                    <rect x="70" y="105" width="30" height="4" rx="2" class="fill-skin-muted transition-colors group-hover:fill-skin-text" />
                                </g>
                                <g class="transition-transform duration-500 group-hover:-translate-y-2 group-hover:translate-x-2">
                                    <circle cx="130" cy="120" r="12" class="fill-skin-sidebar stroke-skin-border transition-colors group-hover:stroke-skin-accent" stroke-width="2"/>
                                    <path d="M130 114V126M124 120H136" class="stroke-skin-accent transition-transform duration-500 group-hover:rotate-90 origin-center" stroke-width="2" stroke-linecap="round"/>
                                </g>
                            </svg>
                        </div>
                        <p class="text-sm font-medium opacity-60 font-mono tracking-wide">Aguardando dados...</p>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        const getStorage = (k, d) => localStorage.getItem(k) || d;
        const setStorage = (k, v) => localStorage.setItem(k, v);

        const els = {
            themeToggle: document.getElementById('theme-toggle'),
            iconContainer: document.getElementById('theme-icon-container'),
            btnA4: document.getElementById('btn-a4'),
            btnThermal: document.getElementById('btn-thermal'),
            btnPrint: document.getElementById('btn-print-toolbar'),
            btnLimpar: document.getElementById('btn-limpar'),
            form: document.getElementById('form-etiqueta'),
            container: document.getElementById('etiquetas-container'),
            dateInput: document.getElementById('form-date'),
            inputs: {
                dest: document.getElementById('destinatario'),
                ped: document.getElementById('pedido'),
                cid: document.getElementById('cidade'),
                vol: document.getElementById('volumes')
            }
        };

        const initDate = () => {
            const now = new Date();
            els.dateInput.value = now.toISOString().split('T')[0];
        };
        initDate();

        // --- THEME LOGIC (3 States) ---
        const themes = ['light', 'dark', 'gruvbox'];
        let currentThemeIndex = themes.indexOf(getStorage('theme', 'light'));
        if(currentThemeIndex === -1) currentThemeIndex = 0;

        const applyTheme = (themeName) => {
            document.documentElement.className = themeName === 'light' ? 'antialiased' : `antialiased ${themeName}`;
            
            // Update Icon
            let iconHtml = '';
            if(themeName === 'light') {
                iconHtml = '<svg class="w-5 h-5 text-amber-500 animate-in fade-in zoom-in duration-500"><use href="#icon-sun"></use></svg>';
            } else if (themeName === 'dark') {
                iconHtml = '<svg class="w-5 h-5 text-indigo-400 animate-in fade-in zoom-in duration-500"><use href="#icon-moon"></use></svg>';
            } else {
                iconHtml = '<svg class="w-5 h-5 text-orange-500 animate-in fade-in zoom-in duration-500"><use href="#icon-cube"></use></svg>';
            }
            els.iconContainer.innerHTML = iconHtml;
            setStorage('theme', themeName);
        };

        els.themeToggle.addEventListener('click', () => {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            applyTheme(themes[currentThemeIndex]);
        });
        
        applyTheme(themes[currentThemeIndex]); // Init

        // --- Print Mode ---
        let currentMode = getStorage('printMode', 'a4');
        const updatePrintModeUI = (mode) => {
            currentMode = mode;
            document.body.classList.toggle('thermal-layout', mode === 'thermal');
            setStorage('printMode', mode);

            const activeClass = ['bg-skin-sidebar', 'text-skin-text', 'shadow-sm'];
            const inactiveClass = ['text-skin-muted', 'hover:text-skin-text', 'bg-transparent', 'shadow-none'];

            const setBtn = (btn, isActive) => {
                btn.className = `px-5 py-2 text-[11px] font-bold rounded-full transition-all uppercase tracking-wide ${isActive ? activeClass.join(' ') : inactiveClass.join(' ')}`;
            };

            setBtn(els.btnA4, mode === 'a4');
            setBtn(els.btnThermal, mode === 'thermal');

            // Injeta a tag @page dinamicamente para garantir zero margens e tamanho exato na impressora Zebra
            let printStyle = document.getElementById('dynamic-print-style');
            if (!printStyle) {
                printStyle = document.createElement('style');
                printStyle.id = 'dynamic-print-style';
                document.head.appendChild(printStyle);
            }
            if (mode === 'thermal') {
                printStyle.innerHTML = '@media print { @page { size: 90mm 50mm; margin: 0; } }';
            } else {
                printStyle.innerHTML = '@media print { @page { size: A4; margin: 0.5cm; } }';
            }

            if (els.container.querySelector('.etiqueta')) {
                if (!document.getElementById('placeholder')) generateLabels(false);
            }
        };

        els.btnA4.addEventListener('click', () => updatePrintModeUI('a4'));
        els.btnThermal.addEventListener('click', () => updatePrintModeUI('thermal'));
        updatePrintModeUI(currentMode);

        const showToast = (message, type = 'default') => {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-6 right-6 z-50 flex items-center gap-3 px-5 py-3.5 
                               bg-skin-sidebar/90 backdrop-blur-md border border-skin-border 
                               rounded-xl shadow-2xl transform transition-all duration-500 ease-out translate-y-20 opacity-0 no-print`;
            toast.innerHTML = `
                <div class="w-2 h-2 rounded-full ${type === 'error' ? 'bg-red-500' : 'bg-skin-accent'} animate-pulse"></div>
                <span class="text-sm font-medium text-skin-text">${message}</span>
            `;
            document.body.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-y-20', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        };

        const generateLabels = (incrementCounter = true) => {
            const data = {
                dest: els.inputs.dest.value,
                ped: els.inputs.ped.value,
                cid: els.inputs.cid.value,
                vol: parseInt(els.inputs.vol.value, 10),
                dateRaw: els.dateInput.value
            };

            if (!data.dest || !data.ped || !data.cid || isNaN(data.vol) || data.vol < 1) return;

            let displayDate = data.dateRaw;
            if (data.dateRaw && data.dateRaw.includes('-')) {
                const [y, m, d] = data.dateRaw.split('-');
                displayDate = `${d}/${m}/${y}`;
            }

            els.container.innerHTML = '';
            els.container.classList.remove('opacity-0');
            
            const LABELS_PER_PAGE = currentMode === 'a4' ? 10 : 1;

            for (let i = 1; i <= data.vol; i++) {
                let pageIndex = Math.ceil(i / LABELS_PER_PAGE);
                let page = els.container.querySelector(`.page-container-screen:nth-child(${pageIndex})`);
                
                if (!page) {
                    page = document.createElement('div');
                    page.className = 'page-container-screen page-container-print bg-transparent shadow-none animate-in fade-in zoom-in-95 duration-500'; 
                    if(currentMode === 'thermal') page.className = 'page-container-screen page-container-print';
                    els.container.appendChild(page);
                }

                // Ajustado o flexbox da etiqueta para garantir que o conteúdo fique perfeitamente centralizado e distribuído
                const html = `
                    <div class="etiqueta p-4 flex flex-col h-full border border-slate-200 bg-white">
                        <input type="text" class="data-stamp" value="${displayDate}" tabindex="-1" title="Edite a data se necessário">
                        
                        <div class="relative z-10 flex flex-col h-full justify-between">
                            <div class="flex justify-between items-start">
                                <h3 class="text-xl font-bold w-3/4 leading-tight text-black">${data.dest}</h3>
                                <div class="volume-box bg-black text-white text-center p-1 px-3 rounded-md">
                                    <span class="font-bold text-xl">${i}/${data.vol}</span>
                                </div>
                            </div>
                            <div class="flex-grow flex flex-col justify-center space-y-1">
                                <p class="text-base text-black leading-tight"><span class="font-bold text-slate-600">Pedido:</span> ${data.ped}</p>
                                <p class="text-base text-black leading-tight"><span class="font-bold text-slate-600">Destino:</span> ${data.cid}</p>
                            </div>
                            <div class="border-t-2 border-dashed border-slate-300 pt-1 text-center mt-auto">
                                <p class="font-bold text-[11px] text-black uppercase tracking-wide">VOLUME ${i} DE ${data.vol}</p>
                            </div>
                        </div>
                    </div>
                `;
                page.insertAdjacentHTML('beforeend', html);
            }
            if (incrementCounter) showToast(`Etiquetas atualizadas!`);
        };

        const debounce = (fn, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => fn(...args), delay);
            };
        };
        const jitHandler = debounce(() => generateLabels(false), 50);
        Object.values(els.inputs).forEach(input => input.addEventListener('input', jitHandler));
        els.dateInput.addEventListener('change', jitHandler);

        let isSubmitting = false;
        els.form.addEventListener('submit', (e) => {
            e.preventDefault();
        });

        els.btnLimpar.addEventListener('click', () => {
            els.form.reset();
            initDate();
            els.container.innerHTML = `
                <div id="placeholder" class="flex flex-col items-center justify-center h-[40vh] text-skin-muted select-none animate-in fade-in duration-700">
                    <div class="relative mb-6 group cursor-pointer">
                        <div class="absolute inset-0 bg-skin-accent/0 group-hover:bg-skin-accent/20 rounded-full blur-2xl transition-all duration-500"></div>
                        <svg class="w-40 h-40 text-skin-text relative z-10 transition-transform duration-500 group-hover:scale-105" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="100" r="60" class="fill-skin-input transition-colors duration-500 group-hover:fill-skin-sidebar" />
                            <rect x="60" y="70" width="80" height="60" rx="4" class="stroke-skin-muted transition-colors duration-500 group-hover:stroke-skin-accent" stroke-width="2" stroke-dasharray="6 6" fill="none"/>
                            <g class="opacity-100 transition-opacity duration-500">
                                <rect x="70" y="85" width="40" height="4" rx="2" class="fill-skin-muted transition-colors group-hover:fill-skin-text" />
                                <rect x="70" y="95" width="60" height="4" rx="2" class="fill-skin-muted transition-colors group-hover:fill-skin-text" />
                                <rect x="70" y="105" width="30" height="4" rx="2" class="fill-skin-muted transition-colors group-hover:fill-skin-text" />
                            </g>
                            <g class="transition-transform duration-500 group-hover:-translate-y-2 group-hover:translate-x-2">
                                <circle cx="130" cy="120" r="12" class="fill-skin-sidebar stroke-skin-border transition-colors group-hover:stroke-skin-accent" stroke-width="2"/>
                                <path d="M130 114V126M124 120H136" class="stroke-skin-accent transition-transform duration-500 group-hover:rotate-90 origin-center" stroke-width="2" stroke-linecap="round"/>
                            </g>
                        </svg>
                    </div>
                    <p class="text-sm font-medium opacity-60 font-mono tracking-wide">Aguardando dados...</p>
                </div>`;
            showToast("Formulário limpo.", "default");
        });

        els.btnPrint.addEventListener('click', () => {
            if (!els.container.querySelector('.etiqueta')) {
                const btn = els.btnPrint;
                btn.classList.add('animate-shake'); 
                setTimeout(() => btn.classList.remove('animate-shake'), 500);
                showToast("Gere as etiquetas antes de imprimir!", "error");
                return;
            }
            window.print();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') els.btnLimpar.click();
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                els.btnPrint.click();
            }
        });
    </script>
</body>
</html>
